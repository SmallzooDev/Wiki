#!/bin/bash

# 디버깅을 위한 로그 출력
echo "Starting pre-commit hook..."

# 스테이징된 마크다운 파일들을 찾습니다
files=$(git diff --cached --name-only --diff-filter=ACM | grep '\.md$')

# 파일 목록 출력
echo "Found files: $files"

for file in $files; do
    echo "Processing file: $file"
    
    # 현재 시간을 KST 기준으로 가져옵니다
    current_time=$(date '+%Y-%m-%d %H:%M:%S +0900')
    echo "Current time: $current_time"
    
    # 파일 내용을 임시 파일에 저장
    tmp_file=$(mktemp)
    cat "$file" > "$tmp_file"
    
    # lastmod 줄을 찾아 수정합니다
    awk -v time="$current_time" '
    /^lastmod:/ {print "lastmod: " time; next}
    {print}
    ' "$tmp_file" > "$file"
    
    # 임시 파일 삭제
    rm "$tmp_file"
    
    # 수정된 파일을 다시 스테이징합니다
    git add "$file"
    echo "Updated and staged: $file"
done

echo "Pre-commit hook completed"
exit 0 